<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sample Tracking</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .chart-container {
            margin-top: 2rem;
            width: 100%;
            height: 400px;
        }

        h1,
        h2 {
            color: #333;
        }
    </style>
</head>

<body>
    <h1>Sample Tracking Dashboard</h1>

    <h2>Sample Data</h2>
    <div hx-get="/api/samples" hx-trigger="load" hx-swap="innerHTML">
        Loading sample data...
    </div>

    <h2>Processing Time Chart</h2>
    <div class="chart-container">
        <canvas id="timingChart"></canvas>
    </div>

    <script>
        document.body.addEventListener('htmx:afterSwap', function (event) {
            if (event.detail.target.getAttribute('hx-get') === '/api/samples') {
                // After samples table is loaded, fetch chart data
                fetch('/api/chart')
                    .then(response => response.json())
                    .then(data => createChart(data));
            }
        });

        function createChart(data) {
            const ctx = document.getElementById('timingChart').getContext('2d');

            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: 'Library Time',
                            data: data.libraryTime,
                            backgroundColor: 'rgba(54, 162, 235, 0.7)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Sequencing Time',
                            data: data.sequencingTime,
                            backgroundColor: 'rgba(255, 99, 132, 0.7)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Days'
                            }
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Samples'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Library and Sequencing Processing Times'
                        },
                        tooltip: {
                            callbacks: {
                                footer: function (tooltipItems) {
                                    const item = tooltipItems[0];
                                    const datasetIndex = item.datasetIndex;
                                    const index = item.dataIndex;

                                    if (datasetIndex === 0) {
                                        return 'Sample ID: ' + data.sampleIds[index];
                                    }
                                    return '';
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>

</html>